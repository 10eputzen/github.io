function AppViewModel(){function e(e){self.list.Objects.removeAll(),e.forEach(function(e){self.list.Objects.push(e)})}self.getMarkerInfo=function(e){var n=markers.find(function(n){return n.name===e.name});updateInfoWindow(n)},self.currentFilter=ko.observable(""),self.worker=ko.computed(function(){self.currentFilter()?self.filterMarkers():firstInit?(e(markers),firstInit=!1):self.filterMarkers()},this),self.filterMarkers=function(){var n=markers.slice(),o=[],i=[];i=self.currentFilter()?ko.utils.arrayFilter(n,function(e){return e.name.toLowerCase().includes(self.currentFilter().toLowerCase())?e:void o.push(e)}):n,removeMarkers(o),showMarkers(i),e(i)}}function removeMarkers(e){for(i=0;i<e.length;i++)e[i].setMap(null)}function showMarkers(e){for(i=0;i<e.length;i++)e[i].setMap(map)}function initMap(){function e(){var e;homeMarkers.length>0?e=homeMarkers[0]:(e=new google.maps.Marker({map:map,position:o,icon:homeIcon,content:"Home"}),homeMarkers.push(e)),google.maps.event.addListener(e,"click",function(){updateInfoWindow(e)});var i={};searchwiki(e).then(function(e){if(markers=[],e){i=e.query.pages;for(var o in i)n(i[o]);markers.forEach(function(e){setMarkerContent(e)}),ko.applyBindings(new AppViewModel)}else alert("No Data available.")}).catch(function(e){var n="An Error has occured while getting data from Wikipedia. \nPlease refresh the page.";alert(n),console.log(e)})}function n(e){var n;e.terms&&(n=e.terms.description[0]);var o={lat:e.coordinates[0].lat,lng:e.coordinates[0].lon},i=new google.maps.Marker({map:map,position:o,name:e.title,image:e.thumbnail,description:n,pageId:e.pageid,content:""});markers.push(i),google.maps.event.addListener(i,"click",function(){updateInfoWindow(i)})}var o=self.currentLocation;map=new google.maps.Map(document.getElementById("map"),{center:{lat:o.lat,lng:o.lng},zoom:16}),infowindow=new google.maps.InfoWindow({maxWidth:infoWindowWidth,name:""}),firstInit&&e();var i=document.getElementById("pac-input"),t=new google.maps.places.SearchBox(i);map.addListener("bounds_changed",function(){t.setBounds(map.getBounds())}),t.addListener("places_changed",function(){var n=t.getPlaces();if(0!==n.length){homeMarkers.forEach(function(e){e.setMap(null)}),homeMarkers=[];var o=new google.maps.LatLngBounds;n.forEach(function(e){homeMarkers.push(new google.maps.Marker({map:map,title:e.name,position:e.geometry.location,icon:homeIcon,content:"Home"})),e.geometry.viewport?o.union(e.geometry.viewport):o.extend(e.geometry.location)}),map.fitBounds(o),e()}})}function setMarkerContent(e){var n,o="<h4>"+e.name+"</h4>";n=e.description?e.description:noDescription;var i="";if(e.image&&(i='<img src="'+e.image.source+'">',width=e.image.width+50),e.pageId){var t,r=e.pageId.toString(),a=queryWikiBase+r+queryWikiAppend,s="An Error has occured while getting data from Wikipedia. \nPlease refresh the page.";queryWiki(a).then(function(a){if(a){t=a.query.pages[r].fullurl,o='<a href="'+t+' " target="_blank">'+o+"</a>";var s=o+"<p>"+n+"</p>"+i;e.content=s}}).catch(function(e){!self.showErrorMessage||alert(s),self.showErrorMessage=!1})}}function updateInfoWindow(e){0!==infowindow.length&&infowindow.close(),infowindow.setContent(e.content),infowindow.open(map,e),map.panTo(e.getPosition()),e.setAnimation(google.maps.Animation.BOUNCE),setTimeout(function(){e.setAnimation(null)},1400)}function searchwiki(e){var n="https://en.wikipedia.org/w/api.php?action=query&prop=coordinates%7Cpageimages%7Cpageterms&colimit=50&piprop=thumbnail&pithumbsize=144&pilimit=50&wbptterms=description&generator=geosearch&ggscoord=",o=e.position,i=o.lat(),t=o.lng(),r=i+"%7C+"+t+"&ggsradius=10000&ggslimit=50&format=json";return queryWiki(n+r)}function queryWiki(e){return $.ajax({url:e,dataType:"jsonp",type:"GET",headers:{"Api-User-Agent":"Example/1.0"}})}function handleError(){var e="Problems while loading Google Maps. Please refresh the page and try again.";alert(e)}$("#menu-toggle").click(function(e){e.preventDefault(),$("#wrapper").toggleClass("toggled")});var self=this,firstInit=!0,ObjectList=function(){var e=this;e.Objects=ko.observableArray()};self.list=new ObjectList;var dropDownLocation=function(e,n,o){this.locationName=e,this.lat=n,this.lng=o},hofheim=new dropDownLocation("Hofheim(Taunus)",50.0900539,8.4624332),munich=new dropDownLocation("Munich",48.135125,11.581981),rockenberg=new dropDownLocation("Rockenberg",50.430259,8.735783),berlin=new dropDownLocation("Berlin",52.520007,13.404954),map,infowindow,markers=[],homeMarkers=[],infowindow=[],homeIcon="https://maps.google.com/mapfiles/ms/icons/green-dot.png",infoWindowWidth=200;self.currentLocation=hofheim;var queryWikiBase="https://en.wikipedia.org/w/api.php?action=query&prop=info&pageids=",queryWikiAppend="&inprop=url&format=json",noDescription="No description available";self.showErrorMessage=!0;